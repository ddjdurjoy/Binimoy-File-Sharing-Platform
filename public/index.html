<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binimoy - P2P File Sharing</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <meta name="description" content="Secure peer-to-peer file sharing directly in your browser">
</head>
<body>
    <header>
        <h1>Binimoy</h1>
        <p>Secure P2P File Sharing</p>
    </header>

    <main id="peers-container">
        <!-- Peer avatars will be dynamically added here -->
    </main>

    <footer>
        <p>Files are transferred directly between peers. No data is stored on servers.</p>
        <button id="create-room" aria-label="Create new room">+</button>
    </footer>

    <!-- Scripts -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/network.js"></script>
    <script src="/js/file-manager.js"></script>
    <script src="/js/ui.js"></script>
    <script>
        // Initialize the application
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Initialize network manager
                await NetworkManager.initialize();
                
                // Initialize UI
                UI.initialize();
                
                // Setup room creation button
                document.getElementById('create-room').addEventListener('click', () => {
                    socket.emit('create-room');
                });
                
                // Connect to signaling server
                const socket = io({
                    transports: ['websocket', 'polling']
                });
                
                // Handle socket events
                socket.on('connect', () => {
                    console.log('Connected to signaling server');
                });
                
                socket.on('room-created', ({ roomId, userId }) => {
                    // Generate and show QR code
                    const url = `${window.location.origin}/join/${roomId}`;
                    UI.showQRCode(url);
                });
                
                socket.on('user-joined', ({ userId, userCount }) => {
                    UI.addPeer(userId);
                });
                
                socket.on('user-left', ({ userId, userCount }) => {
                    UI.removePeer(userId);
                    NetworkManager.disconnectPeer(userId);
                });
                
                socket.on('error', ({ message }) => {
                    UI.showNotification(message, 'error');
                });
                
            } catch (error) {
                console.error('Failed to initialize application:', error);
                UI.showNotification('Failed to initialize application', 'error');
            }
        });
    </script>
</body>
</html> 